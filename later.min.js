later=function(){"use strict";var O={version:"1.2.0"};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0==n)return-1;var r=0;if(1<arguments.length&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(0<r||-1)*Math.floor(Math.abs(r)))),n<=r)return-1;for(var a=0<=r?r:Math.max(n-Math.abs(r),0);a<n;a++)if(a in t&&t[a]===e)return a;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),O.array={},O.array.sort=function(e,t){e.sort(function(e,t){return+e-+t}),t&&0===e[0]&&e.push(e.shift())},O.array.next=function(e,t,n){for(var r,a=0!==n[0],i=0,u=t.length-1;-1<u;--u){if((r=t[u])===e)return r;if(!(e<r||0===r&&a&&n[1]>e))break;i=u}return t[i]},O.array.nextInvalid=function(e,t,n){for(var r=n[0],a=n[1],i=t.length,u=0===t[i-1]&&0!==r?a:0,o=e,f=t.indexOf(e),d=o;o===(t[f]||u);)if(a<++o&&(o=r),++f===i&&(f=0),o===d)return;return o},O.array.prev=function(e,t,n){for(var r,a=t.length,i=0!==n[0],u=a-1,o=0;o<a;o++){if((r=t[o])===e)return r;if(!(r<e||0===r&&i&&n[1]<e))break;u=o}return t[u]},O.array.prevInvalid=function(e,t,n){for(var r=n[0],a=n[1],i=t.length,u=0===t[i-1]&&0!==r?a:0,o=e,f=t.indexOf(e),d=o;o===(t[f]||u);)if(--o<r&&(o=a),-1===--f&&(f=i-1),o===d)return;return o},O.day=O.D={name:"day",range:86400,val:function(e){return e.D||(e.D=O.date.getDate.call(e))},isValid:function(e,t){return O.D.val(e)===(t||O.D.extent(e)[1])},extent:function(e){if(e.DExtent)return e.DExtent;var t=O.M.val(e),n=O.DAYS_IN_MONTH[t-1];return 2===t&&366===O.dy.extent(e)[1]&&(n+=1),e.DExtent=[1,n]},start:function(e){return e.DStart||(e.DStart=O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)))},end:function(e){return e.DEnd||(e.DEnd=O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e)))},next:function(e,t){t=t>O.D.extent(e)[1]?1:t;var n=O.date.nextRollover(e,t,O.D,O.M),e=O.D.extent(n)[1];return t=e<t?1:t||e,O.date.next(O.Y.val(n),O.M.val(n),t)},prev:function(e,t){var n=O.date.prevRollover(e,t,O.D,O.M),e=O.D.extent(n)[1];return O.date.prev(O.Y.val(n),O.M.val(n),!(e<t)&&t||e)}},O.dayOfWeekCount=O.dc={name:"day of week count",range:604800,val:function(e){return e.dc||(e.dc=Math.floor((O.D.val(e)-1)/7)+1)},isValid:function(e,t){return O.dc.val(e)===t||0===t&&O.D.val(e)>O.D.extent(e)[1]-7},extent:function(e){return e.dcExtent||(e.dcExtent=[1,Math.ceil(O.D.extent(e)[1]/7)])},start:function(e){return e.dcStart||(e.dcStart=O.date.next(O.Y.val(e),O.M.val(e),Math.max(1,7*(O.dc.val(e)-1)+1||1)))},end:function(e){return e.dcEnd||(e.dcEnd=O.date.prev(O.Y.val(e),O.M.val(e),Math.min(7*O.dc.val(e),O.D.extent(e)[1])))},next:function(e,t){t=t>O.dc.extent(e)[1]?1:t;var n=O.date.nextRollover(e,t,O.dc,O.M);t=O.dc.extent(n)[1]<t?1:t;var r=O.date.next(O.Y.val(n),O.M.val(n),0===t?O.D.extent(n)[1]-6:1+7*(t-1));return r.getTime()<=e.getTime()?(n=O.M.next(e,O.M.val(e)+1),O.date.next(O.Y.val(n),O.M.val(n),0===t?O.D.extent(n)[1]-6:1+7*(t-1))):r},prev:function(e,t){var n=O.date.prevRollover(e,t,O.dc,O.M),e=O.dc.extent(n)[1];return t=!(e<t)&&t||e,O.dc.end(O.date.prev(O.Y.val(n),O.M.val(n),1+7*(t-1)))}},O.dayOfWeek=O.dw=O.d={name:"day of week",range:86400,val:function(e){return e.dw||(e.dw=O.date.getDay.call(e)+1)},isValid:function(e,t){return O.dw.val(e)===(t||7)},extent:function(){return[1,7]},start:function(e){return O.D.start(e)},end:function(e){return O.D.end(e)},next:function(e,t){return t=7<t?1:t||7,O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)+(t-O.dw.val(e))+(t<=O.dw.val(e)?7:0))},prev:function(e,t){return t=!(7<t)&&t||7,O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e)+(t-O.dw.val(e))+(t>=O.dw.val(e)?-7:0))}},O.dayOfYear=O.dy={name:"day of year",range:86400,val:function(e){return e.dy||(e.dy=Math.ceil(1+(O.D.start(e).getTime()-O.Y.start(e).getTime())/O.DAY))},isValid:function(e,t){return O.dy.val(e)===(t||O.dy.extent(e)[1])},extent:function(e){var t=O.Y.val(e);return e.dyExtent||(e.dyExtent=[1,t%4?365:366])},start:function(e){return O.D.start(e)},end:function(e){return O.D.end(e)},next:function(e,t){t=t>O.dy.extent(e)[1]?1:t;var n=O.date.nextRollover(e,t,O.dy,O.Y),e=O.dy.extent(n)[1];return t=e<t?1:t||e,O.date.next(O.Y.val(n),O.M.val(n),t)},prev:function(e,t){var n=O.date.prevRollover(e,t,O.dy,O.Y),e=O.dy.extent(n)[1];return t=!(e<t)&&t||e,O.date.prev(O.Y.val(n),O.M.val(n),t)}},O.hour=O.h={name:"hour",range:3600,val:function(e){return e.h||(e.h=O.date.getHour.call(e))},isValid:function(e,t){return O.h.val(e)===t},extent:function(){return[0,23]},start:function(e){return e.hStart||(e.hStart=O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e),O.h.val(e)))},end:function(e){return e.hEnd||(e.hEnd=O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e),O.h.val(e)))},next:function(e,t){t=23<t?0:t;var n=O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)+(t<=O.h.val(e)?1:0),t);return!O.date.isUTC&&n.getTime()<=e.getTime()&&(n=O.date.next(O.Y.val(n),O.M.val(n),O.D.val(n),t+1)),n},prev:function(e,t){return t=23<t?23:t,O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e)+(t>=O.h.val(e)?-1:0),t)}},O.minute=O.m={name:"minute",range:60,val:function(e){return e.m||(e.m=O.date.getMin.call(e))},isValid:function(e,t){return O.m.val(e)===t},extent:function(e){return[0,59]},start:function(e){return e.mStart||(e.mStart=O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e),O.h.val(e),O.m.val(e)))},end:function(e){return e.mEnd||(e.mEnd=O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e),O.h.val(e),O.m.val(e)))},next:function(e,t){var n=O.m.val(e),r=O.s.val(e),t=59<t?60-n:t<=n?60-n+t:t-n,n=new Date(e.getTime()+t*O.MIN-r*O.SEC);return!O.date.isUTC&&n.getTime()<=e.getTime()&&(n=new Date(e.getTime()+(t+120)*O.MIN-r*O.SEC)),n},prev:function(e,t){return t=59<t?59:t,O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e),O.h.val(e)+(t>=O.m.val(e)?-1:0),t)}},O.month=O.M={name:"month",range:2629740,val:function(e){return e.M||(e.M=O.date.getMonth.call(e)+1)},isValid:function(e,t){return O.M.val(e)===(t||12)},extent:function(){return[1,12]},start:function(e){return e.MStart||(e.MStart=O.date.next(O.Y.val(e),O.M.val(e)))},end:function(e){return e.MEnd||(e.MEnd=O.date.prev(O.Y.val(e),O.M.val(e)))},next:function(e,t){return t=12<t?1:t||12,O.date.next(O.Y.val(e)+(t>O.M.val(e)?0:1),t)},prev:function(e,t){return t=!(12<t)&&t||12,O.date.prev(O.Y.val(e)-(t>=O.M.val(e)?1:0),t)}},O.second=O.s={name:"second",range:1,val:function(e){return e.s||(e.s=O.date.getSec.call(e))},isValid:function(e,t){return O.s.val(e)===t},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(e,t){var n=O.s.val(e),t=59<t?60-n:t<=n?60-n+t:t-n,n=new Date(e.getTime()+t*O.SEC);return!O.date.isUTC&&n.getTime()<=e.getTime()&&(n=new Date(e.getTime()+(t+7200)*O.SEC)),n},prev:function(e,t,n){return t=59<t?59:t,O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e),O.h.val(e),O.m.val(e)+(t>=O.s.val(e)?-1:0),t)}},O.time=O.t={name:"time",range:1,val:function(e){return e.t||(e.t=3600*O.h.val(e)+60*O.m.val(e)+O.s.val(e))},isValid:function(e,t){return O.t.val(e)===t},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(e,t){t=86399<t?0:t;var n=O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)+(t<=O.t.val(e)?1:0),0,0,t);return!O.date.isUTC&&n.getTime()<e.getTime()&&(n=O.date.next(O.Y.val(n),O.M.val(n),O.D.val(n),O.h.val(n),O.m.val(n),t+7200)),n},prev:function(e,t){return t=86399<t?86399:t,O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)+(t>=O.t.val(e)?-1:0),0,0,t)}},O.weekOfMonth=O.wm={name:"week of month",range:604800,val:function(e){return e.wm||(e.wm=(O.D.val(e)+(O.dw.val(O.M.start(e))-1)+(7-O.dw.val(e)))/7)},isValid:function(e,t){return O.wm.val(e)===(t||O.wm.extent(e)[1])},extent:function(e){return e.wmExtent||(e.wmExtent=[1,(O.D.extent(e)[1]+(O.dw.val(O.M.start(e))-1)+(7-O.dw.val(O.M.end(e))))/7])},start:function(e){return e.wmStart||(e.wmStart=O.date.next(O.Y.val(e),O.M.val(e),Math.max(O.D.val(e)-O.dw.val(e)+1,1)))},end:function(e){return e.wmEnd||(e.wmEnd=O.date.prev(O.Y.val(e),O.M.val(e),Math.min(O.D.val(e)+(7-O.dw.val(e)),O.D.extent(e)[1])))},next:function(e,t){t=t>O.wm.extent(e)[1]?1:t;var n=O.date.nextRollover(e,t,O.wm,O.M),e=O.wm.extent(n)[1];return t=e<t?1:t||e,O.date.next(O.Y.val(n),O.M.val(n),Math.max(1,7*(t-1)-(O.dw.val(n)-2)))},prev:function(e,t){var n=O.date.prevRollover(e,t,O.wm,O.M),e=O.wm.extent(n)[1];return t=!(e<t)&&t||e,O.wm.end(O.date.next(O.Y.val(n),O.M.val(n),Math.max(1,7*(t-1)-(O.dw.val(n)-2))))}},O.weekOfYear=O.wy={name:"week of year (ISO)",range:604800,val:function(e){if(e.wy)return e.wy;var t=O.dw.next(O.wy.start(e),5),n=O.dw.next(O.Y.prev(t,O.Y.val(t)-1),5);return e.wy=1+Math.ceil((t.getTime()-n.getTime())/O.WEEK)},isValid:function(e,t){return O.wy.val(e)===(t||O.wy.extent(e)[1])},extent:function(e){if(e.wyExtent)return e.wyExtent;var t=O.dw.next(O.wy.start(e),5),n=O.dw.val(O.Y.start(t)),t=O.dw.val(O.Y.end(t));return e.wyExtent=[1,5===n||5===t?53:52]},start:function(e){return e.wyStart||(e.wyStart=O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)-(1<O.dw.val(e)?O.dw.val(e)-2:6)))},end:function(e){return e.wyEnd||(e.wyEnd=O.date.prev(O.Y.val(e),O.M.val(e),O.D.val(e)+(1<O.dw.val(e)?8-O.dw.val(e):0)))},next:function(e,t){t=t>O.wy.extent(e)[1]?1:t;var n=O.dw.next(O.wy.start(e),5),e=O.date.nextRollover(n,t,O.wy,O.Y);1!==O.wy.val(e)&&(e=O.dw.next(e,2));n=O.wy.extent(e)[1],e=O.wy.start(e);return t=n<t?1:t||n,O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)+7*(t-1))},prev:function(e,t){var n=O.dw.next(O.wy.start(e),5),e=O.date.prevRollover(n,t,O.wy,O.Y);1!==O.wy.val(e)&&(e=O.dw.next(e,2));n=O.wy.extent(e)[1],e=O.wy.end(e);return t=!(n<t)&&t||n,O.wy.end(O.date.next(O.Y.val(e),O.M.val(e),O.D.val(e)+7*(t-1)))}},O.year=O.Y={name:"year",range:31556900,val:function(e){return e.Y||(e.Y=O.date.getYear.call(e))},isValid:function(e,t){return O.Y.val(e)===t},extent:function(){return[1970,2099]},start:function(e){return e.YStart||(e.YStart=O.date.next(O.Y.val(e)))},end:function(e){return e.YEnd||(e.YEnd=O.date.prev(O.Y.val(e)))},next:function(e,t){return t>O.Y.val(e)&&t<=O.Y.extent()[1]?O.date.next(t):O.NEVER},prev:function(e,t){return t<O.Y.val(e)&&t>=O.Y.extent()[0]?O.date.prev(t):O.NEVER}},O.fullDate=O.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(e,t){return O.fd.val(e)===t},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(e,t){return O.fd.val(e)<t?new Date(t):O.NEVER},prev:function(e,t){return O.fd.val(e)>t?new Date(t):O.NEVER}},O.modifier={},O.modifier.after=O.modifier.a=function(n,e){var r=e[0];return{name:"after "+n.name,range:(n.extent(new Date)[1]-r)*n.range,val:n.val,isValid:function(e,t){return this.val(e)>=r},extent:n.extent,start:n.start,end:n.end,next:function(e,t){return t!=r&&(t=n.extent(e)[0]),n.next(e,t)},prev:function(e,t){return t=t===r?n.extent(e)[1]:r-1,n.prev(e,t)}}},O.modifier.before=O.modifier.b=function(n,e){var r=e[e.length-1];return{name:"before "+n.name,range:n.range*(r-1),val:n.val,isValid:function(e,t){return this.val(e)<r},extent:n.extent,start:n.start,end:n.end,next:function(e,t){return t=t===r?n.extent(e)[0]:r,n.next(e,t)},prev:function(e,t){return t=t===r?r-1:n.extent(e)[1],n.prev(e,t)}}},O.compile=function(e){var l,t,v=[],c=0;for(t in e){var n=t.split("_"),r=n[0],a=n[1],n=e[t],r=a?O.modifier[a](O[r],n):O[r];v.push({constraint:r,vals:n}),c++}return v.sort(function(e,t){e=e.constraint.range,t=t.constraint.range;return t<e?-1:e<t?1:0}),l=v[c-1].constraint,{start:function(e,t){for(var n,r=t,a=O.array[e],i=1e3;i--&&!n&&r;){n=!0;for(var u=0;u<c;u++){var o=v[u].constraint,f=o.val(r),d=o.extent(r),d=a(f,v[u].vals,d);if(!o.isValid(r,d)){r=o[e](r,d),n=!1;break}}}return r!==O.NEVER&&(r="next"===e?l.start(r):l.end(r)),r},end:function(e,t){for(var n,r=O.array[e+"Invalid"],a="next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()},i=c-1;0<=i;i--){var u=v[i].constraint,o=u.val(t),f=u.extent(t),f=r(o,v[i].vals,f);void 0!==f&&(!(f=u[e](t,f))||n&&!a(n,f)||(n=f))}return n},tick:function(e,t){return new Date("next"===e?l.end(t).getTime()+O.SEC:l.start(t).getTime()-O.SEC)},tickStart:function(e){return l.start(e)}}};const S=require("moment-timezone");return O.schedule=function(D){if(!D)throw new Error("Missing schedule definition.");if(!D.schedules)throw new Error("Definition must include at least one schedule.");for(var M=[],e=D.schedules.length,b=[],Y=D.exceptions?D.exceptions.length:0,t=0;t<e;t++)M.push(O.compile(D.schedules[t]));for(var n=0;n<Y;n++)b.push(O.compile(D.exceptions[n]));function r(e,t,n,r,a){var i,u,o=T(e),f=t,d=1e3,l=[],v=[],c=[],s="next"===e,h=s?0:1,m=s?1:0;if(!(n=n?new Date(n):new Date)||!n.getTime())throw new Error("Invalid start date.");for(D.tz&&(n=S(n).tz(D.tz).toDate(),r=r&&S(r).tz(D.tz).toDate()),function(e,t,n,r){for(var a=0,i=t.length;a<i;a++)n[a]=t[a].start(e,r)}(e,M,l,n),function(e,t,n,r){T(e);for(var a=0,i=t.length;a<i;a++){var u=t[a].start(e,r);n[a]=u?[u,t[a].end(e,u)]:O.NEVER}}(e,b,v,n);d--&&f&&(i=function(e,t){for(var n=e[0],r=1,a=e.length;r<a;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}(l,o))&&(!r||!o(i,r));)if(Y&&(function(e,t,n,r){for(var a=T(e),i=0,u=t.length;i<u;i++){var o;n[i]&&!a(n[i][0],r)&&(o=t[i].start(e,r),n[i]=o?[o,t[i].end(e,o)]:O.NEVER)}}(e,b,v,i),w=function(e,t,n){for(var r,a=T(e),i=0,u=t.length;i<u;i++){var o=t[i];!o||a(o[0],n)||o[1]&&!a(o[1],n)||r&&!a(o[1],r)||(r=o[1])}return r}(e,v,i)))E(e,M,l,w);else{if(a){var x=function(e,t){for(var n,r=0,a=e.length;r<a;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}(v,o),w=function(e,t,n,r,a){for(var i,u=T(e),o=0,f=t.length;o<f;o++){var d=n[o];if(d&&d.getTime()===r.getTime()){d=t[o].end(e,d);if(a&&(!d||u(d,a)))return a;i&&!u(d,i)||(i=d)}}return i}(e,M,l,i,x),x=s?[new Date(Math.max(n,i)),w?new Date(r?Math.min(w,r):w):void 0]:[w?new Date(r?Math.max(r,w.getTime()+O.SEC):w.getTime()+O.SEC):void 0,new Date(Math.min(n,i.getTime()+O.SEC))];if(u&&x[h].getTime()===u[m].getTime()?(u[m]=x[m],f++):(u=x,c.push(u)),!w)break;E(e,M,l,w)}else c.push(s?new Date(Math.max(n,i)):function(e,t,n,r){for(var a,i=0,u=t.length;i<u;i++)if(t[i]&&t[i].getTime()===n.getTime()){var o=e[i].tickStart(n);if(r&&o<r)return r;(!a||a<o)&&(a=o)}return a}(M,l,i,r)),function(e,t,n,r){for(var a=0,i=t.length;a<i;a++)n[a]&&n[a].getTime()===r.getTime()&&(n[a]=t[a].start(e,t[a].tick(e,r)))}(e,M,l,i);f--}for(var y=0,p=c.length;y<p;y++){var g=c[y];D.tz&&(g=S(g).tz(D.tz).toDate()),c[y]="[object Array]"===Object.prototype.toString.call(g)?[k(g[0]),k(g[1])]:k(g)}return 0===c.length?O.NEVER:1===t?c[0]:c}function k(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function E(e,t,n,r){for(var a=T(e),i=0,u=t.length;i<u;i++)n[i]&&!a(n[i],r)&&(n[i]=t[i].start(e,r))}function T(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}return{isValid:function(e){return r("next",1,e,e)!==O.NEVER},next:function(e,t,n){return r("next",e||1,t,n)},prev:function(e,t,n){return r("prev",e||1,t,n)},nextRange:function(e,t,n){return r("next",e||1,t,n,!0)},prevRange:function(e,t,n){return r("prev",e||1,t,n,!0)}}},O.setTimeout=function(a,e){var i,u=O.schedule(e);return a&&function e(){var t=Date.now(),n=u.next(2,t);if(!n[0])return void(i=void 0);var r=n[0].getTime()-t;r<1e3&&(r=n[1]?n[1].getTime()-t:1e3);i=r<2147483647?setTimeout(a,r):setTimeout(e,2147483647)}(),{isDone:function(){return!i},clear:function(){clearTimeout(i)}}},O.setInterval=function(t,n){if(t){var r=O.setTimeout(function e(){a||(t(),r=O.setTimeout(e,n))},n),a=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){a=!0,r.clear()}}}},O.date={},O.date.timezone=function(e){O.date.build=e?function(e,t,n,r,a,i){return new Date(e,t,n,r,a,i)}:function(e,t,n,r,a,i){return new Date(Date.UTC(e,t,n,r,a,i))};var t=e?"get":"getUTC",n=Date.prototype;O.date.getYear=n[t+"FullYear"],O.date.getMonth=n[t+"Month"],O.date.getDate=n[t+"Date"],O.date.getDay=n[t+"Day"],O.date.getHour=n[t+"Hours"],O.date.getMin=n[t+"Minutes"],O.date.getSec=n[t+"Seconds"],O.date.isUTC=!e},O.date.UTC=function(){O.date.timezone(!1)},O.date.localTime=function(){O.date.timezone(!0)},O.date.UTC(),O.SEC=1e3,O.MIN=60*O.SEC,O.HOUR=60*O.MIN,O.DAY=24*O.HOUR,O.WEEK=7*O.DAY,O.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],O.NEVER=0,O.date.next=function(e,t,n,r,a,i){return O.date.build(e,void 0!==t?t-1:0,void 0!==n?n:1,r||0,a||0,i||0)},O.date.nextRollover=function(e,t,n,r){var a=n.val(e),n=n.extent(e)[1];return(t||n)<=a||n<t?new Date(r.end(e).getTime()+O.SEC):r.start(e)},O.date.prev=function(e,t,n,r,a,i){var u=arguments.length;return t=u<2?11:t-1,n=u<3?O.D.extent(O.date.next(e,t+1))[1]:n,r=u<4?23:r,a=u<5?59:a,i=u<6?59:i,O.date.build(e,t,n,r,a,i)},O.date.prevRollover=function(e,t,n,r){return n.val(e)<=t||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},O.parse={},O.parse.cron=function(e,t,d){var s={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},l={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function h(e,t,n){return isNaN(e)?s[e]||null:Math.min(+e+(t||0),n||9999)}function m(e,t,n,r,a){var i=n;for(e[t]||(e[t]=[]);i<=r;)e[t].indexOf(i)<0&&e[t].push(i),i+=a||1;e[t].sort(function(e,t){return e-t})}function x(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),m(t,"d",n,n),m(t,"dc",r,r)}function v(e,t,n,r,a,i){var u,o,f,d,l,v=t.schedules,c=v[v.length-1];"L"===e&&(e=r-1),null!==(u=h(e,i,a))?m(c,n,u,u):null!==(u=h(e.replace("W",""),i,a))?(o=t,f=c,d={},l={},1===(t=u)?(m(f,"D",1,3),m(f,"d",s.MON,s.FRI),m(d,"D",2,2),m(d,"d",s.TUE,s.FRI),m(l,"D",3,3)):(m(f,"D",t-1,t+1),m(f,"d",s.MON,s.FRI),m(d,"D",t-1,t-1),m(d,"d",s.MON,s.THU),m(l,"D",t+1,t+1)),m(l,"d",s.TUE,s.FRI),o.exceptions.push(d),o.exceptions.push(l)):null!==(u=h(e.replace("L",""),i,a))?x(v,c,u,r-1):2===(l=e.split("#")).length?x(v,c,u=h(l[0],i,a),h(l[1])):(l=c,c=n,n=r,r=a,a=i,i=+(e=(i=e).split("/"))[1],"*"!==(e=e[0])&&"0"!==e&&(n=h((e=e.split("-"))[0],a,r),r=h(e[1],a,r)||r),m(l,c,n,r,i))}function r(e){return-1<e.indexOf("#")||0<e.indexOf("L")}function c(e,t){return r(e)&&!r(t)?1:e-t}var a,i=(a=(a=e).toUpperCase(),n[a]||a);return function(e){var t,n,r,a,i={schedules:[{}],exceptions:[],tz:d},u=e.replace(/(\s)+/g," ").split(" ");for(t in l)if((r=u[(n=l[t])[0]])&&"*"!==r&&"?"!==r)for(var o=(a=r.split(",").sort(c)).length,f=0;f<o;f++)v(a[f],i,t,n[1],n[2],n[3]);return i}(t?i:"0 "+i)},O.parse.recur=function(){var i,u,o,f,d,l,v,c,s,e=[],t=[],h=e;function r(e,t,n){if(e=d?e+"_"+d:e,i||(h.push({}),i=h[0]),i[e]||(i[e]=[]),u=i[e],f){for(o=[],c=t;c<=n;c+=f)o.push(c);s={n:e,x:f,c:u.length,m:n}}var r=(o=l?[t]:v?[n]:o).length;for(c=0;c<r;c+=1){var a=o[c];u.indexOf(a)<0&&u.push(a)}o=f=d=l=v=0}return{schedules:e,exceptions:t,on:function(){return o=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return f=e||1,this},after:function(e){return d="a",o=[e],this},before:function(e){return d="b",o=[e],this},first:function(){return l=1,this},last:function(){return v=1,this},time:function(){for(var e=0,t=o.length;e<t;e++){var n=o[e].split(":");n.length<3&&n.push(0),o[e]=3600*+n[0]+60*+n[1]+ +n[2]}return r("t"),this},second:function(){return r("s",0,59),this},minute:function(){return r("m",0,59),this},hour:function(){return r("h",0,23),this},dayOfMonth:function(){return r("D",1,v?0:31),this},dayOfWeek:function(){return r("d",1,7),this},onWeekend:function(){return o=[1,7],this.dayOfWeek()},onWeekday:function(){return o=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return r("dc",1,v?0:5),this},dayOfYear:function(){return r("dy",1,v?0:366),this},weekOfMonth:function(){return r("wm",1,v?0:5),this},weekOfYear:function(){return r("wy",1,v?0:53),this},month:function(){return r("M",1,12),this},year:function(){return r("Y",1970,2450),this},fullDate:function(){for(var e=0,t=o.length;e<t;e++)o[e]=o[e].getTime();return r("fd"),this},customModifier:function(e,t){if(!O.modifier[e])throw new Error("Custom modifier "+e+" not recognized!");return d=e,o=t instanceof Array?t:[t],this},customPeriod:function(e){var t=O[e];if(!t)throw new Error("Custom time period "+e+" not recognized!");return r(e,t.extent(new Date)[0],t.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,s.m)},between:function(e,t){return i[s.n]=i[s.n].splice(0,s.c),f=s.x,r(s.n,e,t),this},and:function(){return i=h[h.push({})-1],this},except:function(){return h=t,i=null,this}}},O.parse.text=function(e,i){var u,o=O.parse.recur,v=0,c="",f={eof:/^$/,rank:/^((\d+)(st|nd|rd|th)?)\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},d={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function s(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function l(e){var t,n,r,a,i,u,o=e instanceof Array?e:[e],f=/\s+/;for(o.push(f),i=v;!t||t.type===f;){u=-1,n=c.substring(i),t=s(i,i,c.split(f)[0]);for(var d=o.length,l=0;l<d;l++)(r=(a=o[l]).exec(n))&&0===r.index&&r[0].length>u&&(t=s(i,i+(u=r[0].length),n.substring(0,u),a));t.type===f&&(i=t.endPos)}return t}function n(e){e=l(e);return v=e.endPos,e}function r(e){for(var t=+y(e),n=x(f.through)?+y(e):t,r=[],a=t;a<=n;a++)r.push(a);return r}function h(e){for(var t=r(e);x(f.and);)t=t.concat(r(e));return t}function m(e){var t=w([f.second,f.minute,f.hour,f.dayOfYear,f.dayOfWeek,f.dayInstance,f.day,f.month,f.year,f.weekOfMonth,f.weekOfYear]);switch(t.type){case f.second:e.second();break;case f.minute:e.minute();break;case f.hour:e.hour();break;case f.dayOfYear:e.dayOfYear();break;case f.dayOfWeek:e.dayOfWeek();break;case f.dayInstance:e.dayOfWeekCount();break;case f.day:e.dayOfMonth();break;case f.weekOfMonth:e.weekOfMonth();break;case f.weekOfYear:e.weekOfYear();break;case f.month:e.month();break;case f.year:e.year();break;default:u=v}return t}function x(e){var t=l(e).type===e;return t&&n(e),t}function w(e){var t=n(e);return t.type?t.text=function(e,t){var n=e;switch(t){case f.time:var r=e.split(/(:|am|pm)/),a="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],r=r[2].trim();n=(1===a.length?"0":"")+a+":"+r;break;case f.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case f.monthName:case f.dayName:n=d[e.substring(0,3)]}return n}(t.text,e):u=v,t}function y(e){return w(e).text}return function(e){v=0,c=e,u=-1;for(var t,n,r,a=o();v<c.length&&u<0;)switch(w([f.every,f.after,f.before,f.onthe,f.on,f.of,f.in,f.at,f.and,f.except,f.also]).type){case f.every:t=a,r=n=void 0,x(f.weekend)?t.on(d.sun,d.sat).dayOfWeek():x(f.weekday)?t.on(d.mon,d.tue,d.wed,d.thu,d.fri).dayOfWeek():(n=y(f.rank),t.every(n),r=m(t),x(f.start)?(n=y(f.rank),t.startingOn(n),w(r.type)):x(f.between)&&(n=y(f.rank),x(f.and)&&(r=y(f.rank),t.between(n,r))));break;case f.after:void 0!==l(f.time).type?(a.after(y(f.time)),a.time()):(a.after(y(f.rank)),m(a));break;case f.before:void 0!==l(f.time).type?(a.before(y(f.time)),a.time()):(a.before(y(f.rank)),m(a));break;case f.onthe:r=a,x(f.first)?r.first():x(f.last)?r.last():r.on(h(f.rank)),m(r);break;case f.on:a.on(h(f.dayName)).dayOfWeek();break;case f.of:a.on(h(f.monthName)).month();break;case f.in:a.on(h(f.yearIndex)).year();break;case f.at:for(a.on(y(f.time)).time();x(f.and);)a.on(y(f.time)).time();break;case f.and:break;case f.also:a.and();break;case f.except:a.except();break;default:u=v}return{schedules:a.schedules,exceptions:a.exceptions,error:u,tz:i}}(e.toLowerCase())},O}();